'use strict';(function(v){const w=function(a,c){this.$table=v(a);this.top=window.top.document;this.init(c)};w.prototype={$table:null,app:null,init:function(a){this.app=a;this.loadExtraFields(a.values);this.makeSortable();this.events()},loadOrders:function(a,c){let e;try{e=JSON.parse(a.field_order)}catch(t){}e||(e={});a=this.$table[0].getElementsByTagName("tbody")[0];const b=a.getElementsByTagName("tr"),f=[],d=document.createDocumentFragment();let n;for(let a=0,c=b.length;a<c;++a)b[a].classList.contains("tb_no_sort")?
n=b[a]:f.push(b[a]);f.sort(function(a,b){let d;let f=a.classList.contains("tb_contact_new_row");var g=b.classList.contains("tb_contact_new_row");let m=function(a){for(let b=c.length-1;-1<b;--b)if((c[b].label===a||c[b].id===a)&&void 0!==c[b].order)return c[b].order;return!1};d=f?a.getElementsByClassName("tb_new_field_textbox")[0].value:a.getElementsByClassName("tb_lb_option")[0].id;d=f&&""===d?a.getElementsByClassName("tb_new_field_textbox")[0].dataset.id:d;b=g?b.getElementsByClassName("tb_new_field_textbox")[0].value:
b.getElementsByClassName("tb_lb_option")[0].id;b=g&&""===b?a.getElementsByClassName("tb_new_field_textbox")[0].dataset.id:b;d=d.trim();b=b.trim();a=void 0!==e[d]?e[d]:f?m(d):!1;g=void 0!==e[b]?e[b]:g?m(b):!1;return a-g});for(let a=0,c=f.length;a<c;++a)d.appendChild(f[a]);for(d.appendChild(n);a.firstChild;)a.removeChild(a.firstChild);a.appendChild(d)},loadExtraFields:function(a){let c,e=this.$table[0].getElementsByClassName("tb_no_sort")[0];try{c=JSON.parse(a.field_extra).fields}catch(f){}c||(c={fields:[]});
const b=document.createDocumentFragment();for(let a=0,d=c.length;a<d;++a)b.appendChild(this.addField(c[a]));e.parentNode.insertBefore(b,e);this.loadOrders(a,c)},events:function(){const a=this;this.$table.on("click.tb_contact",".tb_new_field_action",function(c){c.preventDefault();c.stopPropagation();c=this.closest(".tb_no_sort");c.parentNode.insertBefore(a.addField({}),c);a.$table.find("tbody").sortable("refresh");a.changeObject()}).on("change.tb_contact",".tb_new_field_type",function(){a.switchField(this);
a.changeObject()}).on("click.tb_contact",".tb_add_field_option",function(c){c.preventDefault();c.stopPropagation();this.previousElementSibling.appendChild(a.render.getOptions([""]))}).on("keyup.tb_contact",'.tb_contact_new_row input[type="text"], .tb_contact_new_row textarea',function(){a.changeObject()}).on("change.tb_contact",".tb_contact_new_row .tb_new_field_required",function(){a.changeObject()}).on("click.tb_contact",".tb_contact_value_remove,.tb_contact_field_remove",function(c){c.preventDefault();
c.stopPropagation();this.classList.contains("tb_contact_value_remove")?v(this).closest("li").remove():v(this).closest(".tb_contact_new_row").remove();a.changeObject()})},makeSortable:function(){const a=this;this.$table.find("tbody").sortable({items:"tr:not(.tb_no_sort)",placeholder:"ui-state-highlight",axis:"y",containment:"parent",update:function(){a.changeObject()}})},render:{call:function(a,c){return void 0===this[c]?this._default(a,c):this[c].call(this,a,c)},setType:function(a,c){a.setAttribute("data-type",
c)},getText:function(a,c,e){const b=document.createElement(e);"textarea"!==e&&(b.type="tel"!==e?"text":"tel");a.value&&(b.value=a.value);b.className="tb_new_field_value tb_field_type_text";this.setType(b,c);return b},static:function(a,c){a=this._default(a,"textarea");a.placeholder=tb_contact_l10n.static_text;this.setType(a,"static");return a},upload:function(a,c){return document.createElement("div")},getOptions:function(a){const c=document.createDocumentFragment();for(let e in a){let b=document.createElement("li"),
f=document.createElement("a"),d=document.createElement("input");d.type="text";d.className="tb_multi_option";d.value=a[e];f.className="tb_contact_value_remove tf_close";f.href="#";b.appendChild(d);b.appendChild(f);c.appendChild(b)}return c},_default:function(a,c){if("text"===c||"textarea"===c||"tel"===c)return this.getText(a,c,"textarea"===c?c:"input");const e=document.createElement("ul"),b=document.createElement("a"),f=document.createDocumentFragment();e.appendChild(this.getOptions(a.value||[""]));
f.appendChild(e);b.href="#";b.className="tb_add_field_option";b.textContent=tb_contact_l10n.add_option;this.setType(b,c);f.appendChild(b);return f}},addField:function(a){var c=0===Object.keys(a).length;const e=a.type?a.type:"text",b=document.createElement("tr"),f=document.createElement("td"),d=document.createElement("input"),n=document.createElement("td"),t=document.createElement("div"),g=document.createElement("select"),p=document.createDocumentFragment(),u=document.createElement("div"),q=document.createElement("div"),
m=document.createElement("label"),l=document.createElement("input"),k=document.createElement("a"),h=tb_contact_l10n.types,r="tb_"+tb_app.Utils.generateUniqueID();u.className="control-input";q.className="tb_new_field";t.className="selectwrapper";g.className="tb_new_field_type tb_lb_option";b.className="tb_contact_new_row";d.type="text";d.className="tb_new_field_textbox";d.value=void 0===a.label?!0===c?tb_contact_l10n.field_name:"":a.label;d.dataset.id=void 0===a.id?"":a.id;l.type="checkbox";l.className=
"tb_new_field_required";l.value="required";"static"===e&&(m.style.display="none");!0===a.required&&(l.checked=!0);k.className="tb_contact_field_remove tf_close";k.href="#";n.setAttribute("colspan","3");f.appendChild(d);b.appendChild(f);for(let a in h)c=document.createElement("option"),c.name=r,a===e&&(c.selected="selected"),c.value=a,c.textContent=h[a],p.appendChild(c);g.appendChild(p);t.appendChild(g);n.appendChild(t);u.appendChild(this.render.call(a,e));q.appendChild(u);m.appendChild(l);m.appendChild(document.createTextNode(tb_contact_l10n.req));
q.appendChild(m);n.appendChild(q);n.appendChild(k);b.appendChild(n);return b},switchField:function(a){const c=a.value;a=a.closest("td").getElementsByClassName("control-input")[0];const e=a.closest(".tb_new_field").getElementsByClassName("tb_new_field_required")[0].parentNode;for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(this.render.call({},c));e.style.display="static"===c?"none":""},changeObject:function(){var a=this.$table[0].getElementsByTagName("tbody")[0].getElementsByTagName("tr"),
c={fields:[]};const e={};for(let d=0,n=a.length;d<n;++d)if(a[d].classList.contains("tb_contact_new_row")){var b=a[d].getElementsByClassName("tb_new_field_type")[0].options[a[d].getElementsByClassName("tb_new_field_type")[0].selectedIndex].value,f=a[d].getElementsByClassName("tb_new_field_textbox")[0].value.trim();let e="static"!==b&&!0===a[d].getElementsByClassName("tb_new_field_required")[0].checked,g;switch(b){case "text":case "textarea":case "static":case "tel":g=a[d].getElementsByClassName("tb_new_field_value")[0].value.trim();
break;case "radio":case "select":case "checkbox":g=[];let c=a[d].getElementsByClassName("control-input")[0].getElementsByTagName("input");for(let a=0,b=c.length;a<b;++a){let b=c[a].value.trim();""!==b&&g.push(b)}}if(""!==g&&void 0!==g||""!==f)b={type:b,order:d},e&&(b.required=e),""!==f?b.label=f:b.id="ex"+d,void 0!==g&&""!==g&&0<g.length&&(b.value=g),c.fields.push(b)}else a[d].classList.contains("tb_no_sort")||(f=a[d].getElementsByClassName("tb_lb_option")[0].id,e[f]=d);a=this.top.getElementById("field_extra");
a.value=JSON.stringify(c);c=JSON.stringify(e);this.top.getElementById("field_order").value=c;this.app.settings.field_order=c;Themify.triggerEvent(a,"change")}};let x=null;tb_app.Constructor.contact_fields={render:function(a,c){var e=window.top;null===x&&(x=!0,e.Themify.LoadCss(tb_contact_l10n.admin_css,tb_contact_l10n.v));e=document.createElement("tr");const b=document.createElement("table"),f=document.createElement("thead"),d=document.createElement("tbody"),n=document.createElement("tfoot"),t=document.createDocumentFragment(),
g=a.options.head;var p=a.options.body;const u=a.options.foot,q={text:function(a,b,e){a={id:"field_"+a,placeholder:b,"class":"large",type:"text"};e&&(a.help=e);return c.create([a])},checkbox:function(a){const b={id:"field_"+a,new_line:!0,type:"checkbox",options:[{value:"",name:"yes"}]};"sendcopy_active"===a&&(b.binding={checked:{show:["field_sendcopy_subject"]},not_checked:{hide:["field_sendcopy_subject"]}});return c.create([b])}};for(var m in g){var l=document.createElement("th");"l"===m&&(l.colSpan=
2);l.textContent=g[m];e.appendChild(l)}f.appendChild(e);for(var k in p){e=document.createElement("tr");for(var h in g){m=document.createElement("td");l=null;if("f"===h)l=document.createElement("span"),m.textContent=p[k];else if("l"===h){if(m.colSpan="2",l=q.text(k+"_label",p[k]),l.appendChild(q.text(k+"_placeholder",tb_contact_l10n.pl)),"message"!==k){var r=document.createDocumentFragment(),v=q.checkbox(k+"_require");r.appendChild(l);v.querySelector(".tb_lb_option").appendChild(document.createTextNode(tb_contact_l10n.req));
r.appendChild(v);l=r}}else"sh"===h&&(l=q.checkbox(k+"_active"));null!==l&&m.appendChild(l);e.appendChild(m)}t.appendChild(e)}e=document.createElement("tr");k=document.createElement("td");h=document.createElement("a");p=document.createElement("span");h.className="tb_new_field_action";h.href="#";p.className="tf_plus_icon";h.appendChild(p);h.appendChild(document.createTextNode(a.new_row));k.setAttribute("colspan","4");k.appendChild(h);e.className="tb_no_sort";e.appendChild(k);t.appendChild(e);d.appendChild(t);
for(let b in u)if("align"!==b){e=document.createElement("tr");for(let d in g)if("sh"!==d||"send"!==b)a=document.createElement("td"),h=null,"f"===d?a.textContent=u[b]:"l"===d?(a.colSpan=2,k=q.text(b+"_label",u[b]),"send"===b?(a.colSpan=3,r=document.createDocumentFragment(),h=c.select.render({id:u.align.id,options:u.align.options},c),r.appendChild(k),r.appendChild(h),r.appendChild(document.createTextNode(u.align.label)),h=r):"optin"===b?(h=document.createDocumentFragment(),p=ThemifyConstructor.create([{type:"optin_provider",
id:"optin"}]),h.appendChild(k),h.appendChild(p)):h=k,r.appendChild(v)):"sh"===d&&"send"!==b&&(h=q.checkbox(b+"_active"),"captcha"===b&&""!==tb_contact_l10n.captcha&&h.querySelector("input").addEventListener("change",function(a){a=this.closest("td").previousElementSibling;if(!0===this.checked){const b=document.createElement("div");b.className="tb_captcha_message tb_field_error_msg";b.innerHTML=tb_contact_l10n.captcha;a.appendChild(b)}else a=a.getElementsByClassName("tb_captcha_message")[0],"undefined"!==
typeof a&&a.parentNode.removeChild(a)},{passive:!0})),null!==h&&a.appendChild(h),"l"===d&&"sendcopy"===b&&a.appendChild(c.create([{id:"field_"+b+"_subject",after:tb_contact_l10n.sendcopy_sub,type:"text","class":"small"}])),e.appendChild(a);t.appendChild(e)}n.appendChild(t);b.className="contact_fields";b.appendChild(f);b.appendChild(d);b.appendChild(n);document.addEventListener("tb_editing_contact",function(a){const d=new w(b,c);Themify.body.one("themify_builder_lightbox_close",function(a){d.$table.off("click.tb_contact keyup.tb_contact change.tb_contact")})},
{once:!0});return b}}})(jQuery);
